---
title: "Sélectionner des éléments en fonction de leurs données attributaires : requêtes attributaires"
---

::: {.row}

::: {.content .col-xs-12 .col-sm-8 .col-md-9}

* [Faire une requête simple](#VI11)
* [Créer une nouvelle couche à partir d'une sélection](#VI12)
* [Désélectionner des entités](#VI13)
* [Quelques opérateurs](#VI14)
* [Combiner plusieurs critères](#VI15)
* [Quelques exemples à tester](#VI16)

Nous allons voir ici comment utiliser les données de la table attributaire pour sélectionner des éléments d'une couche, par exemple comment sélectionner les départements dans le nom commence par « A » .

Beaucoup d'opérateurs sont disponibles pour les requêtes attributaires; nous ne les passerons pas tous en revue mais allons simplement utiliser quelques-uns des plus courants.

Pour une description de tous les opérateurs et fonctions possibles : voir le [manuel de QGIS](https://docs.qgis.org/3.16/fr/docs/user_manual/working_with_vector/expression.html).

## [Faire une requête simple](#VI11) {#VI11}

Ajoutez la couche *[DEPARTEMENT](donnees/TutoQGIS_06_Requetes.zip)* située dans le dossier **TutoQGIS\_06\_Requetes/donnees**.

Ouvrez la table attributaire de cette couche.

Pour sélectionner le département du Nord (59), vous pouvez cliquez sur le numéro de la ligne correspondante ou bien directement sur ce département sur la carte. Vous pouvez aussi utiliser une requête attributaire.

Dans la barre d'outils située en haut de la table attributaire, cliquez sur l'icône **Sélectionner les entités en utilisant une expression**.

![barre d'outils de la table attributaire avec icône sélection entourée en rouge](illustrations/tous/6_1_BO_icone_selection.png)
Cette icône est aussi accessible dans la barre d'outils **attributs**, à condition que vous ayez au préalable sélectionné la couche dans la table des matières.

La fenêtre de requête attributaire s'ouvre :

[![fenêtre de sélection, avec une requête simple](illustrations/tous/6_1_selection_fenetre.png)](illustrations/tous/6_1_selection_fenetre.png)

Pour faire une requête simple, par exemple pour sélectionner le département du Nord :

* Cliquez sur **Champs et valeurs** dans la colonne du milieu : la liste des champs de la table apparaît
* Double-cliquez sur le champ **NOM\_DEPT** pour le faire apparaître dans la case **Expression** à gauche de la fenêtre (notez les guillemets doubles)
* Cliquez sur l'opérateur **=**
* Cliquez sur le bouton **Toutes** pour voir dans la case **Valeurs** la liste des valeurs uniques du champ sélectionné (ici, NOM\_DEPT)
* Double-cliquez sur la valeur **'NORD'** (notez les guillemets simples)
* A ce stade, la case **Expression** doit contenir : **"NOM\_DEPT" = 'NORD'**
* Cliquez sur le bouton **Sélectionner des entités** en bas de la fenêtre

Il est également possible de taper la requête « à la main » directement dans la case Expression. Attention dans ce cas à bien respecter la syntaxe utilisée par QGIS : par exemple, les noms de champs sont entourés de guillemets doubles et les chaînes de caractères de guillemets simples.

La fenêtre de requête attributaire ne se ferme pas automatiquement ; vous pouvez ou la fermer en cliquant sur le bouton **Fermer** ou bien simplement la déplacer pour vérifier sur la carte le résultat de votre sélection.

[![carte avec le département du Nord sélectionné](illustrations/tous/6_1_selection_nord.png)](illustrations/tous/6_1_selection_nord.png)

Vous pouvez lire le nombre d'éléments sélectionnés en haut de la table attributaire, ou encore en bas à gauche de la fenêtre de QGIS, dans la barre d'état :

[![ligne indiquant le nombre d'éléments sélectionnés, en haut de la table et dans la barre d'état](illustrations/tous/6_1_nb_selectionnes.png)](illustrations/tous/6_1_nb_selectionnes.png)

Vous venez d'effectuer une requête attributaire simple. Il est important de comprendre qu'une requête ne modifie pas les données, elle les sélectionne simplement.

Bien sûr, il est plus intéressant d'utiliser les requêtes pour sélectionner plusieurs éléments en même temps!

Pourquoi pour cette requête l'aperçu du résultat (en bas à gauche de la fenêtre de sélection) est-il égal à 0 ? Cette expression est traitée pour chaque ligne de la table et est évaluée par vrai ou faux, 0 ou 1 pour l'ordinateur. L'aperçu donne un des résultats trouvés, ici le 0.

## [Créer une nouvelle couche à partir d'une sélection](#VI12) {#VI12}

Il est possible de créer une nouvelle couche shapefile à partir d'une sélection.

Votre département du Nord étant toujours sélectionné, faites un clic droit sur la couche de départements → **Exporter → Sauvegarder les entités sélectionnées sous...**

[![fenêtre pour sauvegarder la sélection](illustrations/tous/6_1_sauv_selection_fenetre.png)](illustrations/tous/6_1_sauv_selection_fenetre.png)

* Choisissez le format **GeoPackage**
* Cliquez sur **...** pour choisir à quel endroit sera sauvegardée la nouvelle couche, et sous quel nom, *dept59* par exemple
* Vérifiez que la case **N'enregistrer que les entités sélectionnées** soit cochée
* et cliquez sur **OK**

La nouvelle couche est automatiquement ajoutée à QGIS. Elle ne contient qu'un seul département, celui du Nord.

## [Désélectionner des entités](#VI13) {#VI13}

Par défaut, une nouvelle requête attributaire "part de zéro", en ne tenant pas compte des entités déjà sélectionnées (pour au contraire tenir compte d'une requête précédente, cf. [partie VI.3.1 : Combiner deux requêtes attributaires](06_03_req_combinees.html#VI31)).

Néanmoins, pour plus de clarté, il peut être utile de désélectionner des entités.

![icône de désélection](illustrations/tous/6_3_deselection_icone.png)Pour désélectionner toutes les entités dans toutes les couches : cliquez sur le bouton **Désélectionner toutes les entités** de la barre d'outils Attributs.

Pour désélectionner les entités d'une seule couche, cliquez sur la flèche à côté du même bouton, pour choisir l'option **Désélectionner les entités de la couche courante**, ou bien cliquez sur le bouton **Désélectionner toutes les entités de la couche** en haut de la table attributaire de celle-ci.

## [Quelques opérateurs](#VI14) {#VI14}

Dans l'exemple ci-dessus, nous avons utilisé l'opérateur **=** pour notre requête. Il en existe d'autre, comme par exemple les opérateurs mathématiques inférieur à et supérieur à, multiplier, diviser...

Ajoutez la couche *[communes\_Bretagne](donnees/TutoQGIS_06_Requetes.zip)* située dans le dossier **TutoQGIS\_06\_Requetes/donnees**.

Fermez la table attributaire de la couche de départements et ouvrez celle de la couche de communes. Cette table comporte une colonne **POPULATION** avec la population de chaque commune en nombre d'habitants.

Pouvez-vous dire rapidement quelle est la commune la plus peuplée ?

En cliquant une première fois sur le nom de colonne POPULATION pour classer la population par ordre croissant, puis une deuxième fois pour la classer par ordre décroissant, on peut lire que la commune de Rennes est la plus peuplée avec 216 268 habitants.

![icône de sélection de la table attributaire](illustrations/tous/6_1_selection_attr_icone.png)Nous allons faire une requête pour sélectionner les communes de + de 10 000 habitants. Ouvrez la fenêtre de requête pour la couche de communes :

[![fenêtre de sélection avec une requête pour les communes de population supérieure à 10](illustrations/tous/6_1_popsup10000.png)](illustrations/tous/6_1_popsup10000.png)

* Cliquez sur **Champs et valeurs** pour voir la liste des champs, puis double-cliquez sur le champ **POPULATION**
* Dans la case **Expression**, tapez **> 10000**

Il est également possible d'aller chercher l'opérateur **>** dans la liste des opérateurs, dans la colonne de gauche. Il faut ensuite taper la valeur 10000 à la main.

Une fois votre requête tapée : **"POPULATION" > 10000**, cliquez sur le bouton **Sélectionner des entités** pour voir le résultat :

[![résultat de la requête pour les communes de population supérieure à 10](illustrations/tous/6_1_popsup10000_res.png)](illustrations/tous/6_1_popsup10000_res.png)

Les opérateurs qu'on voit en haut à gauche de la fenêtre de sélection (=, +, - ...) ne représentent qu'une petite partie des opérateurs disponibles ; vous pouvez tous les retrouver dans la catégorie **Opérateurs** de la colonne du milieu. En cliquant sur un opérateur, vous pouvez lire l'aide dans la partie de droite :

[![liste des opérateurs avec aide pour l'opérateur <>](illustrations/tous/6_1_liste_operateurs.png)](illustrations/tous/6_1_liste_operateurs.png)

Parmi ces opérateurs se trouvent par exemple **LIKE** et **ILIKE**. L'opérateur **LIKE** permet de comparer une chaîne de caractère à une autre chaîne qui peut utiliser le caractère joker **%**.

Ce caractère peut remplacer un ou plusieurs caractères : par exemple, 'A%' peut correspondre à Ardèche, Allier...

Sélectionnons les communes dont le nom commence par 'PLOU' !

Ouvrez la fenêtre de sélection pour la couche de communes. Écrivez la requête suivante : **"NOM\_COM\_M" like 'PLOU%'** (soit en la tapant à la main soit en double-cliquant sur les différents éléments).

[![communes dont le nom commence par PLOU](illustrations/tous/6_1_res_plou.png)](illustrations/tous/6_1_res_plou.png)

Notez que, pour du texte, si le caractère % n'est pas utilisé, les opérateurs **=** et **LIKE** sont équivalents.

L'opérateur **ILIKE** est équivalent à **LIKE** mais ne tient pas compte de la casse (majuscules ou minuscules).

![icône de désélection](illustrations/tous/6_3_deselection_icone.png)Entre deux requêtes, pour être sûr de repartir à zéro, utiliser l'outil **tout désélectionner**.

## [Combiner plusieurs critères](#VI15) {#VI15}

Comment faire s'il l'on veut sélectionner par exemple les communes de + de 10 000 habitants dont le nom commence par 'PLOU' ?

Il s'agit ici de combiner deux critères. Deux opérateurs permettent cela : **AND** (et) et **OR** (ou).

* Avec l'opérateur **AND**, **tous les critères** doivent être remplis
* Avec l'opérateur **OR**, il suffit **qu'un seul des critères** soit rempli

Quelle requête utiliser pour sélectionner les communes de plus de 10 000 habitants dont le nom commence par PLOU ?

"NOM\_COM\_M" like 'PLOU%' and "POPULATION" > 10000 : cette requête sélectionne 3 communes.

Quelle requête utiliser pour sélectionner les communes de Brest et Plouzané ?

"NOM\_COM\_M" LIKE 'BREST' OR "NOM\_COM\_M" LIKE 'PLOUZANE' : cette requête sélectionne 2 communes. L'opérateur OR doit être utilisé car les communes ne peuvent satisfaire qu'un seul des critères à la fois (une commune ne peut s'appeler Brest et Plouzané en même temps).

Une autre possibilité, moins lourde, consiste à utiliser l'opérateur **IN** : "NOM\_COMM\_M" IN ('BREST', 'PLOUZANE')

Petite astuce : vous pouvez retrouver les dernières requêtes utilisées dans la rubrique **Récent**, il suffit de double-cliquer sur une requête pour qu'elle apparaisse dans la case Expression :

[![Accès aux requêtes attributaires récentes](illustrations/tous/6_1_requetes_recentes.png)](illustrations/tous/6_1_requetes_recentes.png)

## [Quelques exemples à tester](#VI16) {#VI16}

Voici quelques exemples à tester, plusieurs requêtes sont parfois possibles pour un même résultat.

Pouvez-vous sélectionner ? ...

La commune de Pouldreuzic ?

 "NOM\_COM\_M" like 'POULDREUZIC' : une commune sélectionnée

Les communes du département des Côtes d'Armor (22) ?

"INSEE\_DEP" = '22' : 348 communes sélectionnées

Les communes dont le nom contient 'SAINT' ?

 "NOM\_COM\_M" like '%SAINT%' : 189 communes sélectionnées

Les communes dont le nom commence par 'PLOU' et se termine par 'EC' ?

 "NOM\_COM\_M" like 'PLOU%' AND "NOM\_COM\_M" like '%EC' : 5 communes sélectionnées

Les communes dont la population est comprise entre 10 000 et 50 000 habitants inclus ?

"POPULATION" >= 10000 AND "POPULATION" <= 50000 : 32 communes sélectionnées

Les communes du département du Morbihan (56), dont le nom contient 'PLOU' ou 'EC', et dont la population est inférieure ou égale à 10 000 habitants ?

"INSEE\_DEP" LIKE '56' AND ( "NOM\_COM\_M" LIKE '%PLOU%' OR "NOM\_COM\_M" LIKE '%EC%') AND "POPULATION" <= 10000 : 12 communes sélectionnées

Nous avons vu ici comment sélectionner des entités en fonction de leurs données attributaires. Au chapitre suivant, nous verrons comment sélectionner des entités en fonction de leur position par rapport aux entités d'une autre couche !

[chapitre précédent](06_00_requetes.html)
[chapitre suivant](06_02_req_spatiales.html)

[haut de page](#wrap)

:::

```{r, echo=FALSE}
htmltools::includeHTML("toc06.html")
```

:::

